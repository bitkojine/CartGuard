<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#fff7fb" />
    <title>CartGuard CRM Setup | Code-First, Private Data</title>
    <meta name="description" content="Public CRM technical setup for CartGuard: simple pilot CRM in Git, data private in Airtable, and drift checks from code." />
    <link rel="icon" type="image/svg+xml" href="./assets/logo-mark.svg?v=7" />
    <link rel="alternate icon" href="./assets/favicon.ico?v=7" sizes="any" />
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/apple-touch-icon.png?v=7" />
    <link rel="manifest" href="./site.webmanifest?v=7" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css" />
    <link rel="stylesheet" href="./styles.css" />
    <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-bash.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-json.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-yaml.min.js"></script>
  </head>
  <body>
    <header class="hero page-hero">
      <nav class="top-nav" aria-label="Primary">
        <a href="./index.html" class="nav-brand"><img src="./assets/logo-mark.svg" alt="CartGuard" class="nav-mark" /><span>CartGuard</span></a>
        <div class="nav-links">
          <a href="./index.html">Home</a>
          <a href="./beachhead.html">Beachhead</a>
          <a href="./paid-pilots.html">Paid Pilots</a>
          <a href="./crm-setup.html" aria-current="page">CRM Setup</a>
          <a href="./roadmap.html">Roadmap</a>
          <a href="./research.html">Research</a>
          <a href="./technical.html">Technical</a>
        </div>
      </nav>
      <p class="eyebrow">CRM Setup</p>
      <h1>CRM from code, data private.</h1>
      <p class="lead">We keep CRM structure in GitHub and keep customer data private in Airtable. We use a 3-table model so the team can run pilots fast.</p>
    </header>

    <main>
      <section class="pricing" aria-label="Architecture summary">
        <h2>Architecture</h2>
        <ul>
          <li>Schema spec in Git: versioned and reviewable.</li>
          <li>Customer data in Airtable: private workspace only.</li>
          <li>CI drift checks: fail if base diverges from schema spec.</li>
          <li>Secrets in GitHub Actions: never in repo files.</li>
        </ul>
      </section>

      <section class="architecture" aria-label="Public vs private boundary">
        <h2>What Is Public vs Private</h2>
        <div class="table-wrap">
          <table class="comparison-table">
            <thead>
              <tr>
                <th>Area</th>
                <th>Public (GitHub)</th>
                <th>Private (Airtable / Secrets)</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>CRM schema</td><td>`crm/schema.json`</td><td>None</td></tr>
              <tr><td>Automation scripts</td><td>`scripts/*.mts`</td><td>None</td></tr>
              <tr><td>Customer records</td><td>Never committed</td><td>All rows in Airtable tables</td></tr>
              <tr><td>Credentials</td><td>Never committed</td><td>`AIRTABLE_TOKEN`, `AIRTABLE_BASE_ID` in local env / GitHub secrets</td></tr>
              <tr><td>CI output</td><td>Pass/fail status</td><td>No secret values</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="architecture" aria-label="Repo structure">
        <h2>Suggested Repo Structure</h2>
        <pre><code class="language-text">crm/
  schema.json
scripts/
  crm-types.mts
  check-airtable-crm-schema.mts
  bootstrap-airtable-crm.mts
  seed-airtable-crm-demo.mts</code></pre>
      </section>

      <section class="architecture" aria-label="Run now">
        <h2>Run It Now (No Manual Columns)</h2>
        <pre><code class="language-bash"># 1) set Airtable credentials
export AIRTABLE_TOKEN=your_personal_access_token
export AIRTABLE_BASE_ID=your_airtable_base_id

# 2) dry-run bootstrap (shows what will be created)
pnpm crm:bootstrap

# 3) apply schema changes (create missing tables/fields)
pnpm crm:bootstrap -- --apply

# 4) verify base matches schema
pnpm crm:check

# 5) insert demo records (idempotent)
pnpm crm:seed-demo</code></pre>
      </section>

      <section class="pricing" aria-label="Simple operating process">
        <h2>Simple Process (How Team Uses Airtable)</h2>
        <ol>
          <li>Add or update target accounts in `Accounts`.</li>
          <li>Create one row in `Pilots` when account is qualified.</li>
          <li>Update only 3 pilot fields daily: `Stage`, `Current Missing Doc Rate`, `Next Exec Step`.</li>
          <li>Log every call, blocker, and proof item in `Pilot Notes`.</li>
          <li>At pilot end, set `Pilot Exit Status` to `Converted`, `Lost`, or `Extended`.</li>
        </ol>
      </section>

      <section class="pricing" aria-label="Required token scopes">
        <h2>Required Airtable Token Scope</h2>
        <ul>
          <li>Required: `schema.bases:read`</li>
          <li>Required for bootstrap apply: `schema.bases:write`</li>
          <li>Recommended only if needed later: `data.records:read`, `data.records:write`</li>
          <li>Restrict token access to one base only (CartGuard CRM base).</li>
        </ul>
      </section>

      <section class="architecture" aria-label="Schema example">
        <h2>Schema Spec Example (`crm/schema.json`)</h2>
        <pre><code class="language-json">{
  "baseName": "CartGuard CRM",
  "tables": [
    {
      "name": "Accounts",
      "fields": [
        { "name": "Account Name", "type": "singleLineText" },
        { "name": "Status", "type": "singleSelect", "options": { "choices": ["Target", "Contacted", "Qualified", "Disqualified"] } }
      ]
    },
    {
      "name": "Pilots",
      "fields": [
        { "name": "Pilot ID", "type": "singleLineText" },
        { "name": "Stage", "type": "singleSelect", "options": { "choices": ["Candidate", "Qualified", "Scoped", "Active", "Completed Won", "Completed Lost", "On Hold"] } },
        { "name": "Pilot Fee EUR", "type": "currency" },
        { "name": "Baseline Missing Doc Rate", "type": "number" },
        { "name": "Current Missing Doc Rate", "type": "number" }
      ]
    },
    {
      "name": "Pilot Notes",
      "fields": [
        { "name": "Note ID", "type": "singleLineText" },
        { "name": "Pilot ID", "type": "singleLineText" },
        { "name": "Note Type", "type": "singleSelect", "options": { "choices": ["Review", "Risk", "Evidence", "Decision"] } },
        { "name": "Summary", "type": "multilineText" }
      ]
    }
  ]
}</code></pre>
      </section>

      <section class="pricing" aria-label="Current implementation status">
        <h2>Current Implementation Status</h2>
        <ul>
          <li>`crm/schema.json` is the source of truth for table/field structure.</li>
          <li>Core tables are only `Accounts`, `Pilots`, and `Pilot Notes`.</li>
          <li>`crm:bootstrap` creates missing tables/fields from schema.</li>
          <li>`crm:check` fails when Airtable drifts from schema.</li>
          <li>`crm:seed-demo` inserts pilot-focused demo rows for team training and testing.</li>
        </ul>
      </section>

      <section class="architecture" aria-label="CI example">
        <h2>CI Security + Quality Checks</h2>
        <pre><code class="language-yaml">name: CRM Schema Check

on:
  pull_request:
  push:
    branches: [main]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v4
        with:
          version: 9.15.4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: pnpm
      - run: pnpm install --frozen-lockfile
      - run: pnpm crm:check
        env:
          AIRTABLE_TOKEN: ${{ secrets.AIRTABLE_TOKEN }}
          AIRTABLE_BASE_ID: ${{ secrets.AIRTABLE_BASE_ID }}

# separate workflow: gitleaks secrets scan
# fails if credentials are committed</code></pre>
      </section>

      <section class="pricing" aria-label="Safe protocol">
        <h2>Safe Protocol (Non-Negotiable)</h2>
        <ol>
          <li>Never paste tokens in chat, issues, PR comments, or docs.</li>
          <li>Store `AIRTABLE_TOKEN` only in local shell or GitHub Secrets.</li>
          <li>Run `pnpm crm:check` before and after schema changes.</li>
          <li>Use least privilege scope and one-base-only access.</li>
          <li>Rotate tokens immediately after suspected exposure.</li>
        </ol>
      </section>

      <section class="pricing" aria-label="Privacy rules">
        <h2>Data Safety Rules</h2>
        <ul>
          <li>No customer rows in GitHub.</li>
          <li>No API keys in files or commits.</li>
          <li>Secret scanning is enforced in CI with gitleaks.</li>
          <li>Rotate secrets after team/member changes and any leak event.</li>
        </ul>
      </section>

      <section class="pricing" aria-label="Leak response protocol">
        <h2>Leak Response Protocol</h2>
        <ol>
          <li>Revoke exposed token immediately in Airtable.</li>
          <li>Create new token with minimal scopes.</li>
          <li>Update local env and GitHub Secrets.</li>
          <li>Re-run `pnpm crm:check` and CI scans.</li>
          <li>Document incident in internal notes and continue.</li>
        </ol>
      </section>
    </main>

    <footer>
      <p>CartGuard â€¢ CRM setup by code</p>
    </footer>
  </body>
</html>
