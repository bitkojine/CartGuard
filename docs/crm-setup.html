<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#fff7fb" />
    <title>CartGuard CRM Setup | Code-First, Private Data</title>
    <meta name="description" content="Public CRM technical setup for CartGuard: schema in Git, data private in Airtable, and drift checks from code." />
    <link rel="icon" href="./assets/favicon.ico?v=3" sizes="any" />
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/apple-touch-icon.png?v=3" />
    <link rel="manifest" href="./site.webmanifest?v=4" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="hero page-hero">
      <nav class="top-nav" aria-label="Primary">
        <a href="./index.html" class="nav-brand">CartGuard</a>
        <div class="nav-links">
          <a href="./index.html">Home</a>
          <a href="./beachhead.html">Beachhead</a>
          <a href="./paid-pilots.html">Paid Pilots</a>
          <a href="./crm-setup.html" aria-current="page">CRM Setup</a>
          <a href="./roadmap.html">Roadmap</a>
          <a href="./research.html">Research</a>
          <a href="./technical.html">Technical</a>
        </div>
      </nav>
      <p class="eyebrow">CRM Setup</p>
      <h1>CRM from code, data private.</h1>
      <p class="lead">We keep CRM structure in GitHub and keep customer data private in Airtable. Public repo shows system design, not private records.</p>
    </header>

    <main>
      <section class="pricing" aria-label="Architecture summary">
        <h2>Architecture</h2>
        <ul>
          <li>Schema spec in Git: versioned and reviewable.</li>
          <li>Customer data in Airtable: private workspace only.</li>
          <li>CI drift checks: fail if base diverges from schema spec.</li>
          <li>Secrets in GitHub Actions: never in repo files.</li>
        </ul>
      </section>

      <section class="architecture" aria-label="Repo structure">
        <h2>Suggested Repo Structure</h2>
        <pre><code>crm/
  schema.json
scripts/
  crm-types.mts
  check-airtable-crm-schema.mts
  bootstrap-airtable-crm.mts</code></pre>
      </section>

      <section class="architecture" aria-label="Run now">
        <h2>Run It Now (No Manual Columns)</h2>
        <pre><code># 1) set Airtable credentials
export AIRTABLE_TOKEN=your_personal_access_token
export AIRTABLE_BASE_ID=appXXXXXXXXXXXXXX

# 2) dry-run bootstrap (shows what will be created)
pnpm crm:bootstrap

# 3) apply schema changes (create missing tables/fields)
pnpm crm:bootstrap -- --apply

# 4) verify base matches schema
pnpm crm:check</code></pre>
      </section>

      <section class="architecture" aria-label="Schema example">
        <h2>Schema Spec Example (`crm/schema.json`)</h2>
        <pre><code>{
  "baseName": "CartGuard CRM",
  "tables": [
    {
      "name": "Accounts",
      "fields": [
        { "name": "Account Name", "type": "singleLineText" },
        { "name": "ICP Fit", "type": "number" },
        { "name": "Status", "type": "singleSelect", "options": ["Target", "Contacted", "Qualified", "Disqualified"] }
      ]
    },
    {
      "name": "Deals",
      "fields": [
        { "name": "Account", "type": "linkToRecord", "table": "Accounts" },
        { "name": "Stage", "type": "singleSelect", "options": ["Lead", "Qualified", "Discovery Done", "Pilot Proposed", "Pilot Active", "Won", "Lost"] },
        { "name": "Value EUR", "type": "currency", "precision": 2 },
        { "name": "Next Step", "type": "multilineText" },
        { "name": "Next Step Due", "type": "date" }
      ]
    }
  ]
}</code></pre>
      </section>

      <section class="pricing" aria-label="Current implementation status">
        <h2>Current Implementation Status</h2>
        <ul>
          <li>`crm/schema.json` is the source of truth for table/field structure.</li>
          <li>`crm:bootstrap` creates missing tables/fields from schema.</li>
          <li>`crm:check` fails when Airtable drifts from schema.</li>
        </ul>
      </section>

      <section class="architecture" aria-label="CI example">
        <h2>CI Check Example (`.github/workflows/crm-schema-check.yml`)</h2>
        <pre><code>name: CRM Schema Check

on:
  pull_request:
  push:
    branches: [main]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: pnpm/action-setup@v4
        with:
          version: 9
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: pnpm
      - run: pnpm install --frozen-lockfile
      - run: pnpm tsx scripts/check-airtable-schema.ts
        env:
          AIRTABLE_TOKEN: ${{ secrets.AIRTABLE_TOKEN }}
          AIRTABLE_BASE_ID: ${{ secrets.AIRTABLE_BASE_ID }}</code></pre>
      </section>

      <section class="pricing" aria-label="Privacy rules">
        <h2>Privacy Rules (Non-Negotiable)</h2>
        <ul>
          <li>No customer rows in GitHub.</li>
          <li>No API keys in files or commits.</li>
          <li>Use least-privilege Airtable token scope.</li>
          <li>Rotate secrets after team/member changes.</li>
        </ul>
      </section>

      <section class="pricing" aria-label="Current status">
        <h2>Current Status</h2>
        <p>This page is public technical documentation. Production Airtable base remains private.</p>
      </section>
    </main>

    <footer>
      <p>CartGuard â€¢ CRM setup by code</p>
    </footer>
  </body>
</html>
