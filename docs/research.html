<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#fff7fb" />
    <title>CartGuard Research | Fact-Checked Database</title>
    <meta name="description" content="CartGuard research database with confidence scores, sources, and copy-ready Perplexity prompts." />
    <link rel="icon" type="image/svg+xml" href="./assets/logo-mark.svg?v=7" />
    <link rel="alternate icon" href="./assets/favicon.ico?v=7" sizes="any" />
    <link rel="apple-touch-icon" sizes="180x180" href="./assets/apple-touch-icon.png?v=7" />
    <link rel="manifest" href="./site.webmanifest?v=7" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body class="ops-theme">
    <header class="hero page-hero">
      <nav class="top-nav" aria-label="Primary">
        <a href="./index.html" class="nav-brand"><img src="./assets/logo-mark.svg" alt="CartGuard" class="nav-mark" /><span>CartGuard</span></a>
        <div class="nav-links">
          <a href="./index.html">Home</a>
          <a href="./beachhead.html">Beachhead</a>
          <a href="./paid-pilots.html">Paid Pilots</a>
          <a href="./research.html" aria-current="page">Research</a>
          <a href="./technical.html">Technical</a>
          <a href="./careers.html">Careers</a>
          <a href="./sales.html">Sales Site</a>
                  <button type="button" class="nav-refresh-btn" id="css-hard-refresh">Refresh CSS</button>
        </div>
      </nav>            <section class="warning-banner" aria-label="Brutal priority warning">
        <p class="warning-label">Brutal AI Warning</p>
        <h2>Top priorities and what to do now</h2>
        <ol class="priority-list">
          <li>
            <strong>Priority 1: prove repeatable pilot-to-paid conversion.</strong>
            <ul>
              <li>Run 3 paid pilots with fixed success metrics before start.</li>
              <li>End every pilot with a hard decision: Convert, Extend once, or Stop.</li>
            </ul>
          </li>
          <li>
            <strong>Priority 2: secure budget-owner buy-in early in every pilot.</strong>
            <ul>
              <li>Book budget-owner check-ins in week 1 and at pilot close.</li>
              <li>Track only 3 KPIs: missing-doc rate, review speed, and rework loops.</li>
            </ul>
          </li>
        </ol>
      </section>
      <p class="eyebrow">Research Database</p>
      <h1>Brutal facts, source links, confidence scores.</h1>
      <p class="lead">Everything we claim should map to these entries. If we cannot source it, we do not say it.</p>
    </header>

    <main>
      <section class="pricing" aria-label="Research standards">
        <h2>Research Standards</h2>
        <ul>
          <li>Primary sources first (EU institutions, regulators, official statistics).</li>
          <li>Each entry must include date, geography, confidence, and source links.</li>
          <li>Modeled estimates must be labeled as modeled.</li>
          <li>Recommendations only. No legal determinations.</li>
        </ul>
      </section>

      <section class="pricing" aria-label="Open brutal questions">
        <h2>Open Brutal Questions</h2>
        <ul>
          <li>Can we prove customers pay for this as a product, not consulting support?</li>
          <li>Can we get repeatable pilot-to-paid conversion above 30%?</li>
          <li>Which checks drive real launch-speed outcomes vs compliance theater?</li>
          <li>What evidence would falsify our current beachhead strategy?</li>
        </ul>
      </section>

      <section class="architecture" aria-label="Perplexity prompts">
        <h2>Perplexity Prompt Pack (Copy As-Is)</h2>
        <p class="small-note" id="prompts-updated">Loading prompt pack...</p>
        <div id="prompt-list" class="grid" aria-live="polite"></div>
      </section>

      <section class="architecture" aria-label="Research entries">
        <h2>Research Entries</h2>
        <p class="small-note" id="research-updated">Loading research index...</p>
        <div id="research-list" class="grid" aria-live="polite"></div>
      </section>
    </main>

    <footer>
      <p>CartGuard â€¢ Fact-checked research database</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-markdown.min.js"></script>
    <script>
      const listEl = document.getElementById('research-list');
      const updatedEl = document.getElementById('research-updated');
      const promptListEl = document.getElementById('prompt-list');
      const promptsUpdatedEl = document.getElementById('prompts-updated');
      const docsById = new Map();

      const badgeClass = (confidence) => {
        const c = String(confidence || '').toLowerCase();
        if (c === 'high') return 'status yes';
        if (c === 'medium') return 'status partial';
        return 'status no';
      };

      const renderEntry = (entry) => {
        const card = document.createElement('article');
        card.className = 'card';
        const geo = (entry.geography || []).join(', ');
        const scope = (entry.industry_scope || []).join(', ');
        const inlineDoc = docsById.get(entry.id) || 'No inline document text found for this entry.';
        const sources = Array.isArray(entry.sources)
          ? entry.sources.map((url) => `<li><a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a></li>`).join('')
          : '';
        const escapedDoc = String(inlineDoc)
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;');
        card.innerHTML = `
          <h3>${entry.title}</h3>
          <p>${entry.summary || ''}</p>
          <div class="pill-row">
            <span class="pill">Status: ${entry.status || 'unknown'}</span>
            <span class="pill">Owner: ${entry.owner || 'n/a'}</span>
            <span class="pill">Created: ${entry.created_at || 'n/a'}</span>
            <span class="pill">Verified: ${entry.last_verified_at || 'n/a'}</span>
            <span class="pill">Sources: ${entry.source_count || 0}</span>
            <span class="pill">Geo: ${geo || 'n/a'}</span>
            <span class="pill">Scope: ${scope || 'n/a'}</span>
            <span class="pill">Confidence: <span class="${badgeClass(entry.confidence)}">${entry.confidence || 'low'}</span></span>
          </div>
          <h4 style="margin:.7rem 0 .45rem;">Research Note (Inline)</h4>
          <pre><code class="language-markdown">${escapedDoc}</code></pre>
          <p><a class="btn btn-secondary" href="${entry.repo_url}" target="_blank" rel="noopener noreferrer">Open On GitHub (Optional)</a></p>
          <details><summary>Sources</summary><ul>${sources}</ul></details>
        `;
        if (window.Prism) {
          card.querySelectorAll("code").forEach((node) => window.Prism.highlightElement(node));
        }
        return card;
      };

      const renderPrompt = (p) => {
        const card = document.createElement('article');
        card.className = 'card';
        const escaped = String(p.text || '')
          .replace(/&/g, '&amp;')
          .replace(/</g, '&lt;')
          .replace(/>/g, '&gt;');
        card.innerHTML = `
          <h3>${p.title}</h3>
          <p><strong>ID:</strong> ${p.id}</p>
          <pre><code class="language-markdown">${escaped}</code></pre>
        `;
        if (window.Prism) {
          card.querySelectorAll("code").forEach((node) => window.Prism.highlightElement(node));
        }
        return card;
      };

      const loadDocs = fetch('./assets/research/docs.json')
        .then((r) => {
          if (!r.ok) throw new Error('Failed to load inline research docs');
          return r.json();
        })
        .then((data) => {
          const docs = Array.isArray(data.docs) ? data.docs : [];
          docs.forEach((d) => {
            if (d && d.id) docsById.set(d.id, d.content || '');
          });
        })
        .catch(() => {
          // Keep page usable even if inline docs fail; cards will show fallback text.
        });

      fetch('./assets/research/prompts.json')
        .then((r) => {
          if (!r.ok) throw new Error('Failed to load prompt pack');
          return r.json();
        })
        .then((data) => {
          promptsUpdatedEl.textContent = `Prompt pack updated: ${data.updated_at || 'unknown'}`;
          const prompts = Array.isArray(data.prompts) ? data.prompts : [];
          if (prompts.length === 0) {
            promptListEl.innerHTML = '<article class="card"><h3>No prompts yet</h3></article>';
            return;
          }
          prompts.forEach((p) => promptListEl.appendChild(renderPrompt(p)));
        })
        .catch((err) => {
          promptsUpdatedEl.textContent = 'Failed to load prompt pack.';
          promptListEl.innerHTML = `<article class="card"><h3>Load error</h3><p>${err.message}</p></article>`;
        });

      loadDocs.then(() => fetch('./assets/research/index.json'))
        .then((r) => {
          if (!r.ok) throw new Error('Failed to load research index');
          return r.json();
        })
        .then((data) => {
          updatedEl.textContent = `Research index updated: ${data.updated_at || 'unknown'}`;
          const entries = Array.isArray(data.entries) ? data.entries : [];
          if (entries.length === 0) {
            listEl.innerHTML = '<article class="card"><h3>No entries yet</h3></article>';
            return;
          }
          entries.forEach((entry) => listEl.appendChild(renderEntry(entry)));
        })
        .catch((err) => {
          updatedEl.textContent = 'Failed to load research index.';
          listEl.innerHTML = `<article class="card"><h3>Load error</h3><p>${err.message}</p></article>`;
        });
    </script>
    <script id="data-mobile-table-labels">
    (() => {
      const tables = document.querySelectorAll(".comparison-table");
      tables.forEach((table) => {
        const headers = Array.from(table.querySelectorAll("thead th")).map((th) => th.textContent?.trim() || "Field");
        table.querySelectorAll("tbody tr").forEach((row) => {
          Array.from(row.children).forEach((cell, index) => {
            if (cell instanceof HTMLElement) {
              cell.setAttribute("data-label", headers[index] || headers[0] || "Field");
            }
          });
        });
      });
    })();
  </script>
  <script id="css-refresh-script">
    (() => {
      const button = document.getElementById("css-hard-refresh");
      if (!(button instanceof HTMLButtonElement)) {
        return;
      }
      const refreshCss = () => {
        const stamp = Date.now().toString();
        const links = document.querySelectorAll('link[rel="stylesheet"]');
        links.forEach((node) => {
          if (!(node instanceof HTMLLinkElement)) {
            return;
          }
          const url = new URL(node.href, window.location.href);
          url.searchParams.set("css_refresh", stamp);
          node.href = url.toString();
        });
      };
      button.addEventListener("click", refreshCss);
    })();
  </script>
</body>
</html>
